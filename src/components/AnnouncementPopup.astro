---
const data = {
  btnId: "promotion-dismiss-button",
  title: "Multi Engine Specials",
  description: ``,
  cta: {
    url: "/contact",
    text: "Contact us today",
  },
  offers: [
    {
      title: "Multi Engine Rating Special",
      bullets: [
        "ME Introductory $5,995 (normally $7,495). MEI Introductory $8,995 (normally $10,495).Introductory $8,995 (normally $10,495).  Call, email, text us to reserve your spot!!",
        "up to 10 hours flight instruction (ME) and up to 15 hours (MEI) non-refundable)",
        "housing available at additional cost",
      ],
      cta: {
        url: "/programs/multi-engine#top",
        text: "ME Program Details",
      },
    },
  ],
};
---

<astro-banner btnId={data.btnId} section-key="homepage">
  <div
    class="fixed bottom-0 start-1/2 z-50 mx-auto w-full lg:max-w-5xl -translate-x-1/2 transform max-h-[40rem] overflow-y-auto translate-y-full flex flex-col gap-2 px-4 opacity-0 transition-all duration-500 ease-out"
    role="region"
    aria-label="Promotional Banner"
  >
    <button
      type="button"
      class="ml-auto inline-flex items-center gap-x-2 rounded-full border border-transparent bg-neutral-200/90 p-1 text-sm font-semibold text-dark-blue hover:bg-medium-blue duration-200 disabled:pointer-events-none disabled:opacity-50"
      id={data.btnId}
    >
      <span class="sr-only">Dismiss</span>
      <svg
        class="size-5 flex-shrink-0"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg
      >
    </button>

    <div
      class="rounded-lg bg-neutral-200/90 backdrop-blur-sm pt-4 text-center py-4"
    >
      <div class="flex items-center justify-around flex-col gap-2 mx-auto">
        <span
          class="font-bold uppercase text-primary-700 text-md sm:text-lg"
          set:html={data.title}
        />
        <p class="font-medium text-sm sm:text-lg" set:html={data.description} />
        <ul class="flex flex-col lg:flex-row gap-2">
          {
            data.offers.map((offer, index) => (
              <div class="flex flex-col gap-2 px-2 lg:px-6 second:border-r second:border-gray-400 ">
                {/* <h2 class="uppercase text-lg py-2 h-xl">{offer.title}</h2> */}
                <ul class="list-disc list-inside text-left text-sm lg:text-base ">
                  {offer.bullets.map((bullet) => (
                    <li>{bullet}</li>
                  ))}
                </ul>
                {/* <a
                  href={offer.cta.url}
                  class="px-4 py-2 bg-mariner-900 text-white"
                >
                  {offer.cta.text}
                </a> */}
              </div>
            ))
          }
        </ul>
        <div class="flex justify-center align-middle items-center">
          <a
            href={data.cta.url}
            class="px-4 py-2 bg-primary-700 text-white font-semibold rounded-md"
          >
            {data.cta.text}
          </a>
        </div>
      </div>
    </div>
  </div>
</astro-banner>

<script type="module">
  class AstroBanner extends HTMLElement {
    connectedCallback() {
      const btnId = this.getAttribute("btnId");
      const sectionKey = this.getAttribute("section-key") || "global";
      const storageKey = `ht-banner:${sectionKey}:shown`;

      // If already shown this session for this section, do nothing.
      if (sessionStorage.getItem(storageKey) === "1") return;

      const wrapper = this.querySelector('[role="region"]');
      const button = this.querySelector(`#${CSS.escape(btnId)}`);

      // Show after ~5 seconds
      setTimeout(() => {
        // Double-check: maybe another instance already showed
        if (sessionStorage.getItem(storageKey) === "1") return;
        if (wrapper) {
          wrapper.classList.replace("opacity-0", "opacity-1");
          wrapper.classList.replace("translate-y-full", "-translate-y-10");
        }
        sessionStorage.setItem(storageKey, "1");
      }, 500);

      if (button != null) {
        button.addEventListener("click", () => this.remove());
      }
    }
  }

  customElements.define("astro-banner", AstroBanner);
</script>
