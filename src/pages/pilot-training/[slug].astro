---
import { type CollectionEntry, getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import HeaderSmall from "../../components/HeaderSmall.astro";
import CTAColor from "../../components/CTAColor.astro";
import TrainingRoadmap from "../../components/TrainingRoadmap.astro";
import CTAFlight from "../../data/CTAFlight.js";
import GridPrograms from "../../components/GridPrograms.astro";
import programs from "../../data/programs";
import GeneralFAQs from "../../components/GeneralFAQs";
import Welcome from "../../components/Welcome.astro";

import {
  COMPANY_NAME,
  SITE_DESCRIPTION,
  COMPANY_NAME_CAPS,
  COMPANY_NICKNAME,
  PHONE_NUMBER,
  ADDRESS_LINE_1,
  ADDRESS_LINE_2,
  EMAIL_ADDRESS,
} from "../../consts";

export async function getStaticPaths() {
  const locations = await getCollection("pilot-training");

  return locations.map((entry) => {
    const city = entry.data.city;
    const state = entry.data.stateShort;
    const customSlug = `${city}-${state}`.toLowerCase().replace(/\s+/g, "-");

    return {
      params: { slug: customSlug },
      props: entry, // still pass full entry data
    };
  });
}
type Props = CollectionEntry<"pilot-training">;
const location = Astro.props;
const locationCity = location.data.city || "your area";
const locationStateShort = location.data.stateShort || "your state";
const locationStateLong = location.data.stateLong || "your state";
const baseLocation = location.data.baseLocation || "speedway airport";
const locationDescription =
  location.data.description ||
  "A great place with unique attractions and a welcoming community.";
const locationCounty =
  location.data.baseLocation ||
  "A well-known county with rich history and local charm.";
const locationKeyPlace1 =
  location.data.keyPlace1 || "A popular landmark worth visiting.";
const locationKeyPlace2 =
  location.data.keyPlace2 || "Another must-see location in the area.";

function randomItem(arr: string[]) {
  return arr[Math.floor(Math.random() * arr.length)];
}

const headerImage = randomItem(location.data.headerImages || []);
const rawHeadline = randomItem(location.data.headlines || []);
const headerH1 = rawHeadline
  .replace("{{city}}", locationCity)
  .replace("{{stateShort}}", locationStateShort)
  .replace("{{baseLocation}}", locationCounty);

const data = {
  data: {
    //SEO Header Stuff
    pageTitle: `${locationCity}, ${locationStateLong} Flight School for Pilot Training | ${COMPANY_NAME}`,
    pageDescription: `Explore the top flight school near you, we're based near ${locationCity}, ${locationStateShort}. ${SITE_DESCRIPTION}`,
    pageKeywords: `flight school ${locationCity} ${locationStateLong}, flight school ${locationCity} ${locationStateShort}, Private Pilot ${locationCity} ${locationStateLong}, Instrument Rating  ${locationCity} ${locationStateLong}, Commercial Pilot ${locationCity} ${locationStateLong}, Multi-Engine rating ${locationCity} ${locationStateLong}, Certified Flight Instructor ${locationCity} ${locationStateLong}, Sport Pilot ${locationCity} ${locationStateLong}, bachelor's in professional flight ${locationCity} ${locationStateLong}, bachelor's in aviation management ${locationCity} ${locationStateLong}, aircraft maintenance ${locationCity} ${locationStateLong}, discovery flight ${locationCity} ${locationStateLong}, intro flight ${locationCity} ${locationStateLong}, accelerated pilot training  ${locationCity} ${locationStateLong}, part time pilot training ${locationCity} ${locationStateLong}, ${COMPANY_NAME}, located at ${ADDRESS_LINE_1} ${ADDRESS_LINE_2}, ${PHONE_NUMBER}, ${COMPANY_NAME_CAPS}, ${COMPANY_NICKNAME}, ${EMAIL_ADDRESS}, how to become a pilot, flight school near, private pilot, discovery flight, introductory flight, instrument rating, commercial certificate, certified flight instructor, airline programs, how to become an airline pilot, flight school, pilot training, ${locationCity} flight school, personalized flight training, flexible flight programs, Private Pilot License training, Certified Flight Instructor (CFI) ${locationCity}, multi-engine training ${locationCity}, aviation school in ${locationStateLong}, Cessna 172 training, discovery flights ${locationCity}, pilot school near me, flight training with high pass rate, ${locationKeyPlace1}, ${locationKeyPlace2}, ${locationCounty}`,

    //top header
    header: {
      stars: true,
      imagePath:
        headerImage ||
        "/src/assets/speedway-checkered-flag-atlanta-hampton-georgia-plane-3.webp",
      imageAlt: `Flight school aircraft near ${locationCity}, ${locationStateShort}`,
      headerH1:
        headerH1 ||
        `Train to become a pilot near ${locationCity}, ${locationStateShort}`,
      paragraph: `${COMPANY_NAME} offers personalized pilot training near ${locationCity}, ${locationStateLong}. ${locationDescription}`,
      buttons: [
        {
          name: "Enroll Today",
          link: "/enroll-now",
          primary: false,
        },
        {
          name: "Discovery Flight",
          link: "/discovery-flight",
          primary: false,
        },
      ],
    },
    welcome: {
      title: "Welcome to Speedway Flight Training",
      paragraphs: [
        "At Speedway Flight Training, we’re proud to offer high-quality instruction with a well-maintained fleet in the Greater Atlanta area.",
        "Based in Hampton, GA, at Atlanta Speedway Airport, we provide a safe, structured, and supportive environment for all aspiring pilots.",
        "Whether you’re training for recreational flying or preparing for a professional aviation career, we offer personalized instruction, modern equipment, and comprehensive programs to help you achieve your goals.",
      ],
      imagePath:
        "/src/assets/speedway-flight-training-cessna-172-hampton-ga.webp",
      imageAlt:
        "Cessna 172 at Atlanta Speedway Airport in Hampton, GA, during sunset. Speedway Flight Training's well-maintained fleet provides professional pilot training near Atlanta, offering private, instrument, and commercial flight courses.",
      buttons: [
        {
          text: "About Us",
          link: "/speedway",
        },
      ],
    },
    speedway: {
      upperHeading: "Speedway Flight Training",
      heading: `Fast Track to the Flight Deck <br> Your Path to an <strong class="text-primary-600">Pilot Career</strong> Near <strong class="text-primary-600">${locationCity}, ${locationStateShort} </strong>`,
      descriptions: [
        `Achieve your dream of becoming an airline pilot with ${COMPANY_NAME}. Our Fast Track to the Flight Deck program near ${locationCity}, ${locationStateShort} provides an efficient and structured path from zero experience to a professional aviation career.`,
      ],
      steps: [
        {
          title: "Earn a Private Pilot License (PPL)",
          link: "/programs/private-pilot",
          paragraphs: [
            `Begin your aviation journey in ${locationCity} by earning your Private Pilot License (PPL). Learn core aviation skills, from aircraft operations to communication with air traffic control.`,
            `${COMPANY_NAME} provides hands-on instruction and real-world flight experience near ${locationKeyPlace1} in a personalized and structured program.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-132.webp",
          imageAlt: `Student pilot near ${locationCity}, ${locationStateShort} after their first solo flight.`,
        },
        {
          title: "Add an Instrument Rating (IR)",
          link: "/programs/instrument-rating",
          paragraphs: [
            `Take your skills further with an Instrument Rating and learn to fly in low-visibility weather under Instrument Flight Rules (IFR).`,
            `Training near ${locationCity} gives you exposure to Class B airspace while avoiding major airport congestion—perfect for building IFR confidence.`,
          ],
          imagePath:
            "/src/assets/stock-kristina-delp-xx7EiLeralM-unsplash.webp",
          imageAlt: `Student practicing instrument flight techniques near ${locationCity}.`,
        },
        {
          title: "Earn a Commercial Pilot License (CPL)",
          link: "/programs/commercial-pilot",
          paragraphs: [
            `With your PPL and IR in hand, it's time to earn your Commercial Pilot License (CPL), enabling you to fly professionally.`,
            `Train in ${locationCity}, ${locationStateShort}, where you’ll refine advanced maneuvers and prepare for real-world aviation careers.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-71.webp",
          imageAlt: `Commercial flight training session near ${locationKeyPlace2}.`,
        },
        {
          title: "Earn a Flight Instructor Certificate (CFI)",
          link: "/programs/certified-flight-instructor",
          paragraphs: [
            `Becoming a Certified Flight Instructor (CFI) allows you to earn income while building hours. It’s one of the fastest ways to reach airline minimums.`,
            `At ${COMPANY_NAME} near ${locationCity}, you’ll receive structured instruction to help you train future aviators.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-125.webp",
          imageAlt: `Pre-flight instructor briefing at ${baseLocation}.`,
        },
        {
          title: "Add a Certified Flight Instructor - Instrument (CFII)",
          link: "/programs/certified-flight-instructor",
          paragraphs: [
            `Expand your teaching credentials with a CFII rating, allowing you to instruct on instrument procedures.`,
            `Our CFII program near ${locationCity}, ${locationStateShort}, prepares you to guide students through IFR environments with confidence.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-129.webp",
          imageAlt: `Instructor teaching instrument procedures near ${locationCity}, ${locationStateShort}.`,
        },
        {
          title: "Optional: Add a Multi-Engine Rating (ME)",
          link: "/programs/multi-engine#top",
          paragraphs: [
            `Enhance your credentials with a Multi-Engine Add-On — a valuable asset for airline and charter careers.`,
            `Train in ${locationCounty} with expert instructors and advanced twin-engine aircraft in just 3–5 weeks.`,
          ],
          imagePath: "/src/assets/stock-david-b-o27uCBOPbG0-unsplash.webp",
          imageAlt: `Student in multi-engine aircraft near ${locationCity}, ${locationStateShort}.`,
        },
        {
          title: "Build Flight Hours & Gain Experience",
          paragraphs: [
            `After earning your CFI/CFII (and optionally your Multi-Engine Rating), focus on reaching 1,500 hours—the requirement for your Airline Transport Pilot (ATP) certificate.`,
            `Instructors at ${COMPANY_NAME} build hours efficiently while mentoring others, with some advancing through our partnership with Indy Jet and charter operations.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-38.webp",
          imageAlt: `CFI candidate building hours near ${locationKeyPlace1}.`,
        },
        {
          title: "Interview with Airlines & Begin ATP Training",
          paragraphs: [
            `Once you’ve logged 1,500 hours, you’re eligible to interview with regional airlines and begin ATP training.`,
            `Our graduates near ${locationCity} have successfully entered commercial aviation through a structured, fast-paced training journey.`,
          ],
          imagePath:
            "/src/assets/cessna-172-runway-takeoff-speedway-flight-training.webp",
          imageAlt: `Speedway graduate attending airline interview in ${locationStateLong}.`,
        },
        {
          title: "Begin Your Airline Career",
          paragraphs: [
            `With your ATP certificate in hand, start flying as a First Officer for a regional airline. Build turbine time and grow your experience in commercial operations.`,
            `From your first flight in ${locationCity} to the airline flight deck, ${COMPANY_NAME} supports every step of your journey.`,
          ],
          imagePath:
            "/src/assets/atlanta-airport-Speedway-Flight-Training-134.webp",
          imageAlt: `Airline First Officer preparing flight plan after training in ${locationCity}, ${locationStateShort}.`,
        },
      ],
      finalParagraph: `Start your aviation journey with ${COMPANY_NAME} at ${baseLocation} in ${locationCity}, ${locationStateShort}. Enroll today and fast-track your path to a rewarding airline career.`,
      finalButton: {
        name: "Apply Now",
        link: "/enroll",
        primary: true,
      },
    },
  },
};
---

<BaseLayout
  siteTitle={data.data.pageTitle}
  siteDescription={data.data.pageDescription}
  keywords={data.data.pageKeywords}
>
  <HeaderSmall content={data.data.header} />

  <Welcome content={data.data.welcome} />
  <TrainingRoadmap content={data.data.speedway} />
  <GridPrograms content={programs} />
  <section class="py-14 bg-accent-100">
    <div class="max-w-7xl mx-auto flex justify-center">
      <GeneralFAQs client:visible />
    </div>
  </section>
  <CTAColor content={CTAFlight} />
</BaseLayout>
